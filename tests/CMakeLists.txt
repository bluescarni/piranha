# Add the unit test library.
ADD_DEFINITIONS(-DBOOST_TEST_DYN_LINK)

MACRO(ADD_PIRANHA_TESTCASE arg1)
	IF(CMAKE_BUILD_TYPE STREQUAL "Debug")
		ADD_EXECUTABLE(${arg1} ${arg1}.cpp)
		TARGET_LINK_LIBRARIES(${arg1} ${MANDATORY_LIBRARIES} ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})
		ADD_TEST(${arg1} ${arg1})
	ENDIF(CMAKE_BUILD_TYPE STREQUAL "Debug")
ENDMACRO(ADD_PIRANHA_TESTCASE)

MACRO(ADD_PIRANHA_PERFORMANCE_TESTCASE arg1)
	IF(CMAKE_BUILD_TYPE STREQUAL "Release")
		ADD_EXECUTABLE("${arg1}_perf" "${arg1}_perf.cpp")
		TARGET_LINK_LIBRARIES("${arg1}_perf" ${MANDATORY_LIBRARIES} ${Boost_CHRONO_LIBRARY} ${Boost_TIMER_LIBRARY} ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})
		ADD_TEST("${arg1}_perf" "${arg1}_perf")
	ENDIF(CMAKE_BUILD_TYPE STREQUAL "Release")
ENDMACRO(ADD_PIRANHA_PERFORMANCE_TESTCASE)

ADD_PIRANHA_TESTCASE(array_key)
ADD_PIRANHA_TESTCASE(base_term)
ADD_PIRANHA_TESTCASE(cache_aligning_allocator)
ADD_PIRANHA_TESTCASE(dynamic_aligning_allocator)
ADD_PIRANHA_TESTCASE(echelon_size)
ADD_PIRANHA_TESTCASE(environment)
ADD_PIRANHA_TESTCASE(exceptions)
ADD_PIRANHA_TESTCASE(hash_set)
ADD_PIRANHA_TESTCASE(integer)
ADD_PIRANHA_TESTCASE(kronecker_array)
ADD_PIRANHA_TESTCASE(kronecker_monomial)
# The Intel compiler bombs out on some tests. Need to investigate more.
# NOTE: some of these seem to be limited to ICEs on integer.hpp,
# maybe the switch to mp_integer will make them go away. Others seem
# to involve the decltype() stuff in power_series. Maybe changing the style
# of those will fix it.
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(kronecker_polynomial)
	ADD_PIRANHA_TESTCASE(math)
endif()
ADD_PIRANHA_TESTCASE(memory)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(monomial)
endif()
ADD_PIRANHA_TESTCASE(mp_integer_01)
ADD_PIRANHA_TESTCASE(mp_integer_02)
ADD_PIRANHA_TESTCASE(mp_rational)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(poisson_series)
endif()
ADD_PIRANHA_TESTCASE(poisson_series_term)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(polynomial)
endif()
ADD_PIRANHA_TESTCASE(polynomial_term)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(power_series)
endif()
ADD_PIRANHA_TESTCASE(print_coefficient)
ADD_PIRANHA_TESTCASE(print_tex_coefficient)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(rational)
	ADD_PIRANHA_TESTCASE(real)
	ADD_PIRANHA_TESTCASE(real_trigonometric_kronecker_monomial)
endif()
ADD_PIRANHA_TESTCASE(runtime_info)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(series)
endif()
ADD_PIRANHA_TESTCASE(series_multiplier)
ADD_PIRANHA_TESTCASE(settings)
ADD_PIRANHA_TESTCASE(small_vector)
ADD_PIRANHA_TESTCASE(static_vector)
ADD_PIRANHA_TESTCASE(symbol)
ADD_PIRANHA_TESTCASE(symbol_set)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(t_substitutable_series)
endif()
ADD_PIRANHA_TESTCASE(thread_barrier)
ADD_PIRANHA_TESTCASE(thread_management)
ADD_PIRANHA_TESTCASE(thread_pool)
ADD_PIRANHA_TESTCASE(tracing)
if(NOT CMAKE_COMPILER_IS_INTELXX)
	ADD_PIRANHA_TESTCASE(trigonometric_series)
endif()
ADD_PIRANHA_TESTCASE(tuning)
ADD_PIRANHA_TESTCASE(type_traits)
ADD_PIRANHA_TESTCASE(univariate_monomial)

ADD_PIRANHA_PERFORMANCE_TESTCASE(fateman1)
ADD_PIRANHA_PERFORMANCE_TESTCASE(fateman1_dynamic)
ADD_PIRANHA_PERFORMANCE_TESTCASE(fateman1_unpacked)
ADD_PIRANHA_PERFORMANCE_TESTCASE(fateman2)
ADD_PIRANHA_PERFORMANCE_TESTCASE(gastineau1)
ADD_PIRANHA_PERFORMANCE_TESTCASE(gastineau2)
ADD_PIRANHA_PERFORMANCE_TESTCASE(gastineau3)
ADD_PIRANHA_PERFORMANCE_TESTCASE(gastineau4)
ADD_PIRANHA_PERFORMANCE_TESTCASE(memory)
ADD_PIRANHA_PERFORMANCE_TESTCASE(pearce1)
ADD_PIRANHA_PERFORMANCE_TESTCASE(pearce2)
ADD_PIRANHA_PERFORMANCE_TESTCASE(rectangular)
